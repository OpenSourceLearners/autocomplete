(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],b)}else{if(typeof exports==="object"){module.exports=b(require("jquery"))}else{a.returnExports=b(jQuery)}}})(this,function(g){var b="__autocomplete__";if(g.fn.autocomplete&&g.fn.autocomplete._name&&g.fn.autocomplete._name===b){return}function d(k){if(typeof k!=="object"){return k}var j=g.isArray(k)?[]:{};for(var i in k){j[i]=typeof k[i]==="object"?d(k[i]):k[i]}return j}var c=function(i,k){var j;return function(){var l=this,m=arguments;clearTimeout(j);j=setTimeout(function(){k.apply(l,m)},i)}};function h(i,j){if(!i||!j||typeof j!=="object"){return i}g.each(j,function(k,l){i=i.replace("${"+k+"}",l)});return i}function f(j,i){this.setOptions(i);this.$element=g(j);this.$select=null;this._data=i.data||[];this.lock=false;this.selectedIndex=-1;if(typeof i.ajax==="string"){this.ajaxRenderOptions()}else{this.renderOptions();this.bindEvent()}}f.DEFAULTOPTIONS={valueKey:"value",htmlKey:"html",selectClass:"",render:null,ajax:null,handleData:null,params:{}};f.prototype.version="v1.0.1";f.prototype.setOptions=function(i){this.options=i;this.htmlKey=i.htmlKey||"html";this.valueKey=i.valueKey||"value";!g.isArray(this.options.selectClass)&&(this.options.selectClass=[this.options.selectClass]);this.options.selectClass.push("autocomplete")};f.prototype.ajaxRenderOptions=function(){var i=this;g.getJSON(this.options.ajax,this.options.params).then(function(j){typeof i.options.handleData==="function"&&(j=i.options.handleData(j));j=j||{};j.data=j.data||[];i._data=j.data;i.renderOptions();i.bindEvent()})};f.prototype.renderOptions=function(){var i=g("<ul></ul>");var k=this;var j=this.options.render;g.each(this._data,function(m,o){var n=typeof o;var l=n==="object"?o[k.htmlKey]:o;if(typeof j==="function"){l=j(o)}else{if(typeof j==="string"){l=h(j,o)}}var p=g('<li data-value="'+(n==="object"?o[k.valueKey]:o)+'">'+l+"</li>");p.data("data",o);i.append(p)});this.$select=i.addClass(this.options.selectClass.join(" "));g("body").append(this.$select)};f.prototype.bindEvent=function(){this.$element.on("focus.show",g.proxy(this.onShowSelect,this));this.$element.on("blur.hide",g.proxy(this.onHideSelect,this));this.$element.on("keyup.instruct",g.proxy(this.onInstruct,this));this.$select.on("mousedown.fill","li",g.proxy(this.onFill,this));this.$select.on("mouseup.fill","li",g.proxy(this.onFill,this));this.$select.on("mousemove.hover","li",c(7,g.proxy(this.onHover,this)))};f.prototype.onShowSelect=function(k,j){var l=this.$element.offset();var i={width:this.$element.outerWidth(true),top:l.top+this.$element.outerHeight(true),left:l.left};this.$select.css(i).addClass("is-show");if(!j){this.selected(this.$select.find("li:eq("+this.selectedIndex+")"))}};f.prototype.onHideSelect=function(i){if(this.lock){return}this.$select.removeClass("is-show")};f.prototype.onFill=function(i){var j=g(i.currentTarget);if(i.type==="mousedown"){this.$element.trigger("focus.show",true)}else{if(i.type==="mouseup"){this.setSelectionIndex(j.index());this.$element.val(j.attr("data-value"));this.$element.trigger("blur.hide")}}i.preventDefault()};f.prototype.onInstruct=function(m){var l=[13,27,38,40];if(g.inArray(m.keyCode,l)===-1&&this.$element.hasClass("is-show")){return}var i=g("li.active",this.$select);switch(m.keyCode){case 13:this.setSelectionIndex(i.index());this.$element.val(i.attr("data-value"));case 27:this.$element.trigger("blur.hide");break;case 38:var k=i.prev();k.length&&this.selected(k);break;case 40:var j=i.next();j.length&&this.selected(j);break}};f.prototype.destroy=function(){this.$select.remove();this.$element.off("focus.show");this.$element.off("blur.hide");this.$element.off("keyup.instruct")};f.prototype.selected=function(i){g("li.active",this.$select).removeClass("active");g(i).addClass("active")};f.prototype.onHover=function(i){this.selected(i.currentTarget)};f.prototype.getSelectedIndex=function(){return this.selectedIndex};f.prototype.setSelectionIndex=function(j){if(this.selectedIndex==j){return}if(j<-1){j=-1}this.selectedIndex=j;var i=this.$select.find("li:eq("+this.selectedIndex+")");this.selected(i);this.$element.trigger("selected",[i.data("data"),j])};function e(i,j){if(typeof i==="object"){i=g.extend({},f.DEFAULTOPTIONS,i);this.each(function(k,l){if(this._autocomplete){this._autocomplete.destroy();this._autocomplete=null}this._autocomplete=new f(l,i)})}else{if(typeof i==="string"){this.each(function(k,l){this.autocomplete&&typeof this.autocomplete[i]==="function"&&this.autocomplete[i](j)})}else{throw new Error("输入下拉插件：参数错误")}}return this}e._name=b;var a=g.fn.autocomplete;if(g.fn.autocomplete){e.noConflict=function(){return a}}g.fn.autocomplete=e});