(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],b)}else{if(typeof exports==="object"){module.exports=b(require("jquery"))}else{a.returnExports=b(jQuery)}}})(this,function(d){if(d.fn.autocomplete){return}function b(h){if(typeof h!=="object"){return h}var g=d.isArray(h)?[]:{};for(var f in h){g[f]=typeof h[f]==="object"?b(h[f]):h[f]}return g}var a=function(f,h){var g;return function(){var i=this,j=arguments;clearTimeout(g);g=setTimeout(function(){h.apply(i,j)},f)}};function e(f,g){if(!f||!g||typeof g!=="object"){return f}d.each(g,function(h,i){f=f.replace("${"+h+"}",i)});return f}function c(g,f){this.setOptions(f);this.$element=d(g);this.$select=null;this._data=f.data||[];this.lock=false;this.selectedIndex=-1;if(typeof f.ajax==="string"){this.ajaxRenderOptions()}else{this.renderOptions();this.bindEvent()}}c.DEFAULTOPTIONS={valueKey:"value",htmlKey:"html",selectClass:"",render:null,ajax:null,handleData:null,params:{}};c.prototype.version="v1.0.1";c.prototype.setOptions=function(f){this.options=f;this.htmlKey=f.htmlKey||"html";this.valueKey=f.valueKey||"value";!d.isArray(this.options.selectClass)&&(this.options.selectClass=[this.options.selectClass]);this.options.selectClass.push("autocomplete")};c.prototype.ajaxRenderOptions=function(){var f=this;d.getJSON(this.options.ajax,this.options.params).then(function(g){typeof f.options.handleData==="function"&&(g=f.options.handleData(g));g=g||{};g.data=g.data||[];f._data=g.data;f.renderOptions();f.bindEvent()})};c.prototype.renderOptions=function(){var f=d("<ul></ul>");var h=this;var g=this.options.render;d.each(this._data,function(k,m){var l=typeof m;var j=l==="object"?m[h.htmlKey]:m;if(typeof g==="function"){j=g(m)}else{if(typeof g==="string"){j=e(g,m)}}var n=d('<li data-value="'+(l==="object"?m[h.valueKey]:m)+'">'+j+"</li>");n.data("data",m);f.append(n)});this.$select=f.addClass(this.options.selectClass.join(" "));d("body").append(this.$select)};c.prototype.bindEvent=function(){this.$element.on("focus.show",d.proxy(this.onShowSelect,this));this.$element.on("blur.hide",d.proxy(this.onHideSelect,this));this.$element.on("keyup.instruct",d.proxy(this.onInstruct,this));this.$select.on("mousedown.fill","li",d.proxy(this.onFill,this));this.$select.on("mouseup.fill","li",d.proxy(this.onFill,this));this.$select.on("mousemove.hover","li",a(7,d.proxy(this.onHover,this)))};c.prototype.onShowSelect=function(h,g){var i=this.$element.offset();var f={width:this.$element.outerWidth(true),top:i.top+this.$element.outerHeight(true),left:i.left};this.$select.css(f).addClass("is-show");if(!g){this.selected(this.$select.find("li:eq("+this.selectedIndex+")"))}};c.prototype.onHideSelect=function(f){if(this.lock){return}this.$select.removeClass("is-show")};c.prototype.onFill=function(f){var g=d(f.currentTarget);if(f.type==="mousedown"){this.$element.trigger("focus.show",true)}else{if(f.type==="mouseup"){this.setSelectionIndex(g.index());this.$element.val(g.attr("data-value"));this.$element.trigger("blur.hide")}}f.preventDefault()};c.prototype.onInstruct=function(j){var i=[13,27,38,40];if(d.inArray(j.keyCode,i)===-1&&this.$element.hasClass("is-show")){return}var f=d("li.active",this.$select);switch(j.keyCode){case 13:this.setSelectionIndex(f.index());this.$element.val(f.attr("data-value"));case 27:this.$element.trigger("blur.hide");break;case 38:var h=f.prev();h.length&&this.selected(h);break;case 40:var g=f.next();g.length&&this.selected(g);break}};c.prototype.destroy=function(){this.$select.remove();this.$element.off("focus.show");this.$element.off("blur.hide");this.$element.off("keyup.instruct")};c.prototype.selected=function(f){d("li.active",this.$select).removeClass("active");d(f).addClass("active")};c.prototype.onHover=function(f){this.selected(f.currentTarget)};c.prototype.getSelectedIndex=function(){return this.selectedIndex};c.prototype.setSelectionIndex=function(g){if(g<-1){g=-1}this.selectedIndex=g;var f=this.$select.find("li:eq("+this.selectedIndex+")");this.selected(f);this.$element.trigger("selected",[f.data("data"),g])};d.fn.autocomplete=function(f,g){if(typeof f==="object"){f=d.extend({},c.DEFAULTOPTIONS,f);this.each(function(h,i){if(this._autocomplete){this._autocomplete.destroy();this._autocomplete=null}this._autocomplete=new c(i,f)})}else{if(typeof f==="string"){this.each(function(h,i){this.autocomplete&&typeof this.autocomplete[f]==="function"&&this.autocomplete[f](g)})}else{throw new Error("输入下拉插件：参数错误")}}return this}});