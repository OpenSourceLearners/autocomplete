(function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):t.returnExports=e(jQuery)})(this,function(t){function e(e,i){return e&&i&&"object"==typeof i?(t.each(i,function(t,i){e=e.replace("${"+t+"}",i)}),e):e}function i(t){var e="\\$()*+.[]?^{}|".split("");return e.forEach(function(e){t=t.replace(new RegExp("\\"+e,"g"),`\\${e}`)}),t}function s(e,i){this.setOptions(i),this.$element=t(e),this.$select=t("<ul></ul"),this.$select.addClass(this.options.selectClass.join(" ")),t("body").append(this.$select),this.bindEvent(),this.lock=!1,this.selectedIndex=-1,this.init(i)}function o(e){if("object"==typeof e)e=t.extend({},s.DEFAULTOPTIONS,e),this.each(function(t,i){this._autocomplete&&(this._autocomplete.destroy(),this._autocomplete=null),this._autocomplete=new s(i,e)});else{if("string"!=typeof e)throw new Error("输入下拉插件：参数错误");var i=Array.prototype.slice.call(arguments,1);this.each(function(t,s){this._autocomplete&&"function"==typeof this._autocomplete[e]&&this._autocomplete[e].apply(this._autocomplete,i)})}return this}var n="__autocomplete__";if(!t.fn.autocomplete||!t.fn.autocomplete._name||t.fn.autocomplete._name!==n){var a=function(t,e){var i;return function(){var s=this,o=arguments;clearTimeout(i),i=setTimeout(function(){e.apply(s,o)},t)}};s.DEFAULTOPTIONS={valueKey:"value",htmlKey:"html",selectClass:"",render:null,ajax:null,handleData:null,params:{},filter:!1,filterFields:"keyword",fill:"value",immediate:!0,ajaxOptions:{},handleSendData:null},s.prototype.version="v1.0.2",s.prototype.init=function(t){"string"==typeof t.ajax?t.immediate&&this.ajaxRenderOptions():this.updateData(t.data)},s.prototype.setOptions=function(e){this.options=e,-1===["value","html"].indexOf(this.options.fill)&&(this.options.fill="value"),this.htmlKey=e.htmlKey||"html",this.valueKey=e.valueKey||"value",!t.isArray(this.options.selectClass)&&(this.options.selectClass=[this.options.selectClass]),this.options.selectClass.push("autocomplete")},s.prototype.ajaxRenderOptions=function(){var e=this,i={};i[this.options.filterFields]=this.$element.val();var s=t.extend({},this.options.params,i);"function"==typeof this.options.handleSendData&&(s=this.options.handleSendData(s)),t.ajax(t.extend({url:this.options.ajax,data:s},this.options.ajaxOptions)).then(function(t){"function"==typeof e.options.handleData&&(t=e.options.handleData(t)),t=t||{},e.updateData(t.data)})},s.prototype.renderOptions=function(i){this.selectedIndex=-1,t.isArray(i)||(i=this._data);var s=this.$select;s.empty();var o=this,n=this.options.render;t.each(i,function(i,a){var l=a.html;"function"==typeof n?l=n(a._data):"string"==typeof n&&(l=e(n,a._data));var r=t('<li data-value="'+a[o.options.fill]+'">'+l+"</li>");r.data("data",a._data),s.append(r)})},s.prototype.bindEvent=function(){this.$element.on("focus.show",t.proxy(this.onShowSelect,this)),this.$element.on("blur.hide",t.proxy(this.onHideSelect,this)),this.$element.on("keyup.instruct",t.proxy(this.onInstruct,this)),this.$element.on("input.filter",a(200,t.proxy(this.onFilter,this))),this.$select.on("mousedown.fill","li",t.proxy(this.onFill,this)),this.$select.on("mouseup.fill","li",t.proxy(this.onFill,this)),this.$select.on("mousemove.hover","li",a(7,t.proxy(this.onHover,this)))},s.prototype.onShowSelect=function(t,e){var i=this.$element.offset(),s={width:this.$element.outerWidth(!0),top:i.top+this.$element.outerHeight(!0),left:i.left};this.$select.css(s).addClass("is-show"),e||this.renderSelected()},s.prototype.onHideSelect=function(t){this.lock||this.$select.removeClass("is-show")},s.prototype.onFill=function(e){var i=t(e.currentTarget);"mousedown"===e.type?this.$element.trigger("focus.show",!0):"mouseup"===e.type&&(this.setSelectionIndex(i.index()),this.$element.val(i.attr("data-value")),this.$element.trigger("blur.hide")),e.preventDefault()},s.prototype.onInstruct=function(e){var i=[13,27,38,40];if(-1!==t.inArray(e.keyCode,i)||!this.$element.hasClass("is-show")){var s=t("li.active",this.$select);switch(e.keyCode){case 13:this.setSelectionIndex(s.index()),this.$element.val(s.attr("data-value"));case 27:this.$element.trigger("blur.hide");break;case 38:var o=0===s.length?this.$select.find(":first"):s.prev();o.length&&this.selected(o);break;case 40:var n=0===s.length?this.$select.find(":first"):s.next();n.length&&this.selected(n)}}},s.prototype.onFilter=function(e){if(this.options.filter)if("string"==typeof this.options.ajax)this.ajaxRenderOptions();else{var s=this.$element.val(),o=new RegExp(i(s)),n=[];t.each(this._data,function(t,e){o.test(e.html)&&n.push(e)}),this.renderOptions(n)}},s.prototype.destroy=function(){this.$select.remove(),this.$element.off("focus.show"),this.$element.off("blur.hide"),this.$element.off("keyup.instruct")},s.prototype.selected=function(e){t("li.active",this.$select).removeClass("active"),t(e).addClass("active")},s.prototype.renderSelected=function(){t("li.active",this.$select).removeClass("active"),this.selectedIndex<=-1||this.$select.find("li:eq("+this.selectedIndex+")").addClass("active")},s.prototype.onHover=function(t){this.selected(t.currentTarget)},s.prototype.getSelectedIndex=function(){return this.selectedIndex},s.prototype.setSelectionIndex=function(t){if(this.selectedIndex!=t){t<-1&&(t=-1),this.selectedIndex=t,this.renderSelected();var e=this.$select.find(":eq("+t+")").data("data");-1!=t&&this.$element.trigger("selected",[e,this._originData.indexOf(e)])}},s.prototype.updateData=function(e){t.isArray(e)||(e=[]);var i=this;this._originData=e,this._data=e.map(function(e){var s=typeof e;return t.extend({},{value:"object"===s?e[i.valueKey]:e,html:"object"===s?e[i.htmlKey]:e,_data:e})}),this.renderOptions()},o._name=n;var l=t.fn.autocomplete;t.fn.autocomplete&&(o.noConflict=function(){return l}),t.fn.autocomplete=o}});